<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestore Palette Colori</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const Copy = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        const Download = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Plus = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Check = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const PaletteManager = () => {
            const [colors, setColors] = useState([]);
            const [inputText, setInputText] = useState('');
            const [assignments, setAssignments] = useState({});
            const [showSuccess, setShowSuccess] = useState(false);

            const variables = [
                { key: 'DESKTOPBG', label: 'Background desktop', category: 'Primary' },
                { key: 'BG', label: 'Primary Background', category: 'Primary' },
                { key: 'FG', label: 'Primary Foreground' , category: 'Primary' },
                { key: 'BGSELECT', label: 'Background selection', category: 'Primary'' },
                { key: 'TEXTSELECT', label: 'selected Text', category: 'Primary' },
                { key: 'CURSOR', label: 'Cursor', category: 'Primary' }
                { key: 'TEXTINCURSOR', label: 'Text inside cursore', category: 'Primary' },
                { key: 'black', label: 'black (normal)', category: 'Base' },
                { key: 'blackl', label: 'black (light)', category: 'Base' },
                { key: 'red', label: 'Rosso (normal)', category: 'Red' },
                { key: 'redl', label: 'Rosso (light)', category: 'Red' },
                { key: 'green', label: 'green (normal)', category: 'Green' },
                { key: 'greenl', label: 'green (light)', category: 'Green' },
                { key: 'yellow', label: 'yellow (normal)', category: 'yellow' },
                { key: 'yellowl', label: 'yellow (light)', category: 'yellow' },
                { key: 'blue', label: 'Blue (normal)', category: 'Blue' },
                { key: 'bluel', label: 'Blue (light)', category: 'Blue' },
                { key: 'magenta', label: 'Magenta (normal)', category: 'Magenta' },
                { key: 'magental', label: 'Magenta (light)', category: 'Magenta' },
                { key: 'cyan', label: 'Cyan (normal)', category: 'Cyan' },
                { key: 'cyanl', label: 'Cyan (light)', category: 'Cyan' },
                { key: 'white', label: 'white (normal)', category: 'white' },
                { key: 'whitel', label: 'white (light)', category: 'white' },
            ];

            const extractColors = (text) => {
                const hexPattern = /#[0-9A-Fa-f]{6}\b/g;
                const matches = text.match(hexPattern);
                return matches ? [...new Set(matches)] : [];
            };

            const handlePaste = () => {
                const extracted = extractColors(inputText);
                setColors(extracted);
                setInputText('');
            };

            const handleColorAssignment = (varKey, color) => {
                setAssignments(prev => ({ ...prev, [varKey]: color }));
            };

            const generateScript = () => {
                let script = '#!/bin/bash\n\n# PRIMARY PALETTE \n';

                const mainVars = ['BG', 'FG', 'CURSOR', 'TEXTSELECT', 'BGSELECT', 'DESKTOPBG', 'TEXTINCURSOR'];
                mainVars.forEach(key => {
                    const color = assignments[key] || '#d5d7d6';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Colori base (black)\n';
                ['COLOR0', 'COLOR8'].forEach(key => {
                    const color = assignments[key] || '#4a5353';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Red\n';
                ['COLOR1', 'COLOR9'].forEach(key => {
                    const color = assignments[key] || '#b65f5c';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Grenn\n';
                ['COLOR2', 'COLOR10'].forEach(key => {
                    const color = assignments[key] || '#6d896d';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Yellow\n';
                ['COLOR3', 'COLOR11'].forEach(key => {
                    const color = assignments[key] || '#d79921';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Blue\n';
                ['COLOR4', 'COLOR12'].forEach(key => {
                    const color = assignments[key] || '#458588';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Magenta\n';
                ['COLOR5', 'COLOR13'].forEach(key => {
                    const color = assignments[key] || '#b16286';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Cyan\n';
                ['COLOR6', 'COLOR14'].forEach(key => {
                    const color = assignments[key] || '#689d6a';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# white\n';
                ['COLOR7', 'COLOR15'].forEach(key => {
                    const color = assignments[key] || '#ebdbb2';
                    script += `export ${key}="${color}"\n`;
                });

                script += '\n# Semantic colors\n';
                script += `export ACCENT="${assignments['COLOR4'] || '$COLOR4'}"\n`;
                script += `export URGENT="${assignments['COLOR1'] || '$COLOR1'}"\n`;
                script += `export SUCCESS="${assignments['COLOR2'] || '$COLOR2'}"\n`;
                script += `export WARNING="${assignments['COLOR3'] || '$COLOR3'}"\n`;

                return script;
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generateScript());
                setShowSuccess(true);
                setTimeout(() => setShowSuccess(false), 2000);
            };

            const downloadScript = () => {
                const blob = new Blob([generateScript()], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'palette.sh';
                a.click();
            };

            const groupedVars = variables.reduce((acc, v) => {
                if (!acc[v.category]) acc[v.category] = [];
                acc[v.category].push(v);
                return acc;
            }, {});

            return (
                <div className="w-full max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <h1 className="text-3xl font-bold mb-6 text-gray-800">Gestore Palette Colori</h1>

                    <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h2 className="text-xl font-semibold mb-4">1. Incolla i tuoi colori</h2>
                        <textarea
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            placeholder="Incolla qui i tuoi colori hex (es: #ff5733 #3498db #2ecc71)..."
                            className="w-full h-32 p-3 border border-gray-300 rounded-lg mb-3 font-mono text-sm"
                        />
                        <button
                            onClick={handlePaste}
                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                        >
                            <Plus />
                            Estrai colori
                        </button>
                    </div>

                    {colors.length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-semibold">Colori disponibili ({colors.length})</h2>
                                <button
                                    onClick={() => setColors([])}
                                    className="text-red-500 hover:text-red-600 flex items-center gap-1"
                                >
                                    <Trash2 />
                                    Cancella
                                </button>
                            </div>
                            <div className="flex flex-wrap gap-3">
                                {colors.map((color, idx) => (
                                    <div key={idx} className="flex flex-col items-center">
                                        <div
                                            className="w-16 h-16 rounded-lg shadow-md border-2 border-gray-300"
                                            style={{ backgroundColor: color }}
                                        />
                                        <span className="text-xs mt-1 font-mono">{color}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {colors.length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <h2 className="text-xl font-semibold mb-4">2. Assegna i colori alle variabili</h2>
                            {Object.entries(groupedVars).map(([category, vars]) => (
                                <div key={category} className="mb-6">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-3 border-b pb-2">{category}</h3>
                                    <div className="grid gap-3">
                                        {vars.map(v => (
                                            <div key={v.key} className="flex items-center gap-3 flex-wrap">
                                                <div className="w-48 text-sm">
                                                    <span className="font-mono font-semibold">{v.key}</span>
                                                    <span className="text-gray-500 ml-2">- {v.label}</span>
                                                </div>
                                                <div className="flex gap-2 flex-wrap">
                                                    {colors.map((color, idx) => (
                                                        <button
                                                            key={idx}
                                                            onClick={() => handleColorAssignment(v.key, color)}
                                                            className={`w-10 h-10 rounded border-2 transition-all ${
                                                                assignments[v.key] === color
                                                                    ? 'border-blue-500 ring-2 ring-blue-300'
                                                                    : 'border-gray-300 hover:border-gray-400'
                                                            }`}
                                                            style={{ backgroundColor: color }}
                                                            title={color}
                                                        />
                                                    ))}
                                                </div>
                                                {assignments[v.key] && (
                                                    <span className="text-xs font-mono text-gray-600">{assignments[v.key]}</span>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {Object.keys(assignments).length > 0 && (
                        <div className="bg-white rounded-lg shadow-md p-6">
                            <h2 className="text-xl font-semibold mb-4">3. Esporta lo script</h2>
                            <div className="flex gap-3">
                                <button
                                    onClick={copyToClipboard}
                                    className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex items-center gap-2"
                                >
                                    {showSuccess ? <Check /> : <Copy />}
                                    {showSuccess ? 'Copiato!' : 'Copia negli appunti'}
                                </button>
                                <button
                                    onClick={downloadScript}
                                    className="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex items-center gap-2"
                                >
                                    <Download />
                                    Scarica palette.sh
                                </button>
                            </div>

                            <div className="mt-4">
                                <h3 className="text-sm font-semibold mb-2">Anteprima:</h3>
                                <pre className="bg-gray-900 text-green-400 p-4 rounded-lg text-xs overflow-x-auto max-h-64">
                                    {generateScript()}
                                </pre>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<PaletteManager />, document.getElementById('root'));
    </script>
</body>
</html>
